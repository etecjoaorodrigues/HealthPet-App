<!DOCTYPE html>
<html lang="pt-br">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Meu Perfil</title>
  <link rel="manifest" href="/manifest.json">
  <meta name="theme-color" content="#000000">
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.7/dist/css/bootstrap.min.css" rel="stylesheet">
  <style>
    body {
      background-color: #d3d5da;
      font-family: 'Poppins', sans-serif;
    }

    .navbar {
      position: fixed;
      bottom: 0;
      left: 0;
      width: 100%;
      background-color: #2F93D6;
      display: flex;
      justify-content: space-around;
      padding: 12px 0;
      z-index: 999;
    }
.navbar a {
      font-size: 16px;
      color: white;
      text-decoration: none;
      padding: 10px;
      border-radius: 6px;
      transition: background 0.3s, color 0.3s;
    }
.navbar a:hover {
      background-color: #ddd;
      color: black;
    }
.navbar a {
        font-size: 14px;
        padding: 8px;
      }

    .profile-container {
      max-width: 900px;
      margin: 50px auto;
      background: #fff;
      border-radius: 16px;
      box-shadow: 0 4px 15px rgba(0,0,0,0.1);
      padding: 30px;
    }

    .profile-header {
      text-align: center;
      margin-bottom: 30px;
    }

    .profile-header h1 {
      font-size: 2rem;
      font-weight: 600;
      color: #333;
    }

    .section-title {
      font-size: 1.25rem;
      font-weight: 600;
      color: #555;
      border-left: 4px solid #007bff;
      padding-left: 10px;
      margin-bottom: 20px;
    }

    .info-box {
      background-color: #f9fafb;
      border: 1px solid #e2e8f0;
      border-radius: 10px;
      padding: 20px;
      margin-bottom: 25px;
    }

    .info-item {
      display: flex;
      justify-content: space-between;
      padding: 8px 0;
      border-bottom: 1px solid #eee;
    }

    .info-item:last-child {
      border-bottom: none;
    }

    .info-item span:first-child {
      font-weight: 600;
      color: #444;
    }

    .info-item span:last-child {
      color: #666;
    }

    .pet-type {
      text-transform: capitalize;
    }

    .btn-delete {
            width: 150px;
            margin-bottom: 18px;
            font-size: 1.1rem;
            font-weight: 600;
            background: red;
            color: #fff;
            border: none;
            border-radius: 8px;
            padding: 14px 0;
            transition: background 0.3s;
        }
        .btn-delete:hover {
            background: darkred;
            color: white;
        }
        
    @media (max-width: 576px) {
      .info-item {
        flex-direction: column;
        align-items: flex-start;
      }
    }
  </style>
</head>
<body>

  <div id="div" class="profile-container">
    <div class="profile-header">
      <h1>Meu Perfil</h1>
    </div>

    <!-- DADOS DO USUÁRIO -->
    <div class="user-section">
      <div class="section-title">Dados do Usuário</div>
      <div class="info-box">
        <div class="info-item">
          <span>Nome:</span>
          <span id="nome"></span>
        </div>
        <div class="info-item">
          <span>Email:</span>
          <span id="email"></span>
        </div>
        <div class="info-item">
          <span>Telefone:</span>
          <span id="telefone"></span>
        </div>
        <div class="info-item">
          <span>Senha:</span>
          <span id="senha"></span>
        </div>
      </div>
    </div>

    <!-- DADOS DO PET -->
    <div class="pet-section">
      <div class="section-title">Dados do Pet</div>
      <div class="info-box">
        <div class="info-item">
          <span>Tipo:</span>
          <span class="pet-type" id="tipoPet"></span>
        </div>
        <div class="info-item">
          <span>Raça:</span>
          <span id="raca"></span>
        </div>
        <div class="info-item">
          <span>Pelagem:</span>
          <span id="pelagem"> </span>
        </div>
        <div class="info-item">
          <span>Porte:</span>
          <span id="porte"></span>
        </div>
        <div class="info-item">
          <span>Peso:</span>
          <span id="peso">Kg</span>
        </div>
        <div class="info-item">
          <span>Castrado:</span>
          <span id="castrado"></span>
        </div>
        <div class="info-item">
          <span>Vacinado:</span>
          <span id="vacinado"></span>
        </div>
        <div class="info-item">
          <span>Vermifugado:</span>
          <span id="Vermifugado"></span>
        </div>
      </div>
    </div>
    <div>
      <button type="submit" class="btn btn-delete">Sair</button>
    </div>
  </div>

  <div class="navbar">
    <a href="homeScreen.html">Monitor</a>
    <a href="agenda.html">Agenda</a>
    <a href="blog.html">Blog</a>
    <a href="userDados.html">Perfil</a>
  </div>


    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <script type="module">
    const { createClient } = supabase
    const _supabase = createClient(
      'https://blcgszqtzogwdwbhgbwq.supabase.co',
      'sb_publishable_TegOLAB84L10PLHHKNu7EA_qSA0A112')

    const { data: { user }, error: userError } = await _supabase.auth.getUser()
    if (userError || !user) {
      alert("Você precisa estar logado para visualizar o perfil")
      // window.location.href = 'Login.html'
    } else {
      // ✅ Troque 'auth_id' pelo nome correto da coluna na sua tabela 'usuario'
      let { data: usuario, error } = await _supabase
        .from('usuario')
        .select('*')
        .eq('auth_id', user.id) 

      if (error) {
        console.error("Erro ao buscar dados do usuário:", error)
      } else if (usuario && usuario.length > 0) {
        document.getElementById('nome').textContent = usuario[0].nome
        document.getElementById('email').textContent = usuario[0].email
        document.getElementById('telefone').textContent = usuario[0].telefone
        document.getElementById('senha').textContent = usuario[0].senha
      } else {
        console.warn("Nenhum dado de usuário encontrado para o ID:", user.id)
      }

      let { data: dados_pet, error: petError } = await _supabase
        .from('pet')
        .select('*')
        .eq('tutor_auth', user.id)

      if (!petError && dados_pet.length > 0) {
        const pet = dados_pet[0]
        document.getElementById('tipoPet').textContent = pet.tipo_animal
        document.getElementById('raca').textContent = pet.raca
        document.getElementById('pelagem').textContent = pet.pelagem
        document.getElementById('porte').textContent = pet.porte
        document.getElementById('peso').textContent = pet.peso + " kg"
        document.getElementById('castrado').textContent = pet.castrado ? "Sim" : "Não"
        document.getElementById('vacinado').textContent = pet.vacinas ? "Sim" : "Não"
        document.getElementById('Vermifugado').textContent = pet.vermifugado ? "Sim" : "Não"
      }
    }

    document.getElementById("div").addEventListener('click', async function (event) {
      console.log("Logout iniciado");
        event.preventDefault();
        const { error } = await _supabase.auth.signOut();
        if (error) {
            console.error("Erro ao deslogar:", error);
        } else {
            window.location.href = 'https://healthpet-app.netlify.app/site/Login'; // Redireciona para a página de login após o logout
        }

    });
</script>


</body>
</html>
